<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Human Liver - Labeled Anatomy</title>
    <style>
        :root {
            --liver-red: #8b2626;
            --vein-blue: #3182ce;
            --artery-red: #e53e3e;
            --bile-gold: #b29e00;
        }
        body { margin: 0; overflow: hidden; background: #0a0a0a; font-family: 'Inter', system-ui, sans-serif; color: white; }
        
        #header {
            position: absolute;
            top: 20px;
            left: 20px;
            z-index: 10;
            background: rgba(139, 38, 38, 0.2);
            padding: 10px 20px;
            border-radius: 8px;
            border: 1px solid rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
        }
        h1 { margin: 0; font-size: 1.2rem; letter-spacing: 1px; color: #ff9999; text-transform: uppercase; }

        .label-box {
            position: absolute;
            bottom: 30px;
            right: 30px;
            width: 300px;
            background: rgba(0, 0, 0, 0.8);
            border-left: 4px solid var(--liver-red);
            padding: 20px;
            border-radius: 4px;
            pointer-events: none;
            display: none;
            transition: all 0.3s ease;
        }

        .label-title { font-weight: bold; font-size: 1.1rem; color: #ff6b6b; margin-bottom: 5px; }
        .label-desc { font-size: 0.85rem; line-height: 1.4; color: #ccc; }

        #controls {
            position: absolute;
            bottom: 20px;
            left: 20px;
            font-size: 0.7rem;
            opacity: 0.4;
            letter-spacing: 1px;
        }
    </style>
</head>
<body>

    <div id="header">
        <h1>Anatomical Human Liver</h1>
    </div>

    <div id="label-info" class="label-box">
        <div class="label-title" id="title">Part Name</div>
        <div class="label-desc" id="desc">Description goes here.</div>
    </div>

    <div id="controls">DRAG TO ROTATE • SCROLL TO ZOOM • HOVER TO IDENTIFY</div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        let scene, camera, renderer, liverGroup, raycaster, mouse;
        let INTERSECTED = null;
        const clock = new THREE.Clock();

        const labels = {
            'Inferior Vena Cava': 'The large vein that carries deoxygenated blood from the lower and middle body into the right atrium of the heart.',
            'Aorta': 'The main artery that carries oxygenated blood from the heart to the rest of the body.',
            'Gall bladder': 'A small pouch that sits just under the liver. It stores bile produced by the liver.',
            'Hepatic artery': 'A short blood vessel that supplies oxygenated blood to the liver, pylorus of the stomach, duodenum, and pancreas.',
            'Portal vein': 'A vessel that moves blood from the spleen and gastrointestinal tract to the liver.',
            'Common bile duct': 'A tube-like structure formed where the common hepatic duct and the cystic duct join. It transmits bile from the gallbladder to the small intestine.',
            'Liver Tissue': 'The largest solid organ in the body, performing critical metabolic and detoxifying functions.'
        };

        function init() {
            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(0, 1, 10);

            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setClearColor(0x0a0a0a);
            document.body.appendChild(renderer.domElement);

            // Lighting
            const ambient = new THREE.AmbientLight(0xffffff, 0.4);
            scene.add(ambient);
            const directional = new THREE.DirectionalLight(0xffffff, 0.8);
            directional.position.set(5, 5, 5);
            scene.add(directional);

            liverGroup = new THREE.Group();
            scene.add(liverGroup);

            createModel();

            raycaster = new THREE.Raycaster();
            mouse = new THREE.Vector2();

            window.addEventListener('resize', onWindowResize);
            document.addEventListener('mousemove', onMouseMove);

            // Simple Drag Controls
            let isDragging = false;
            let previousMouse = { x: 0, y: 0 };
            document.addEventListener('mousedown', () => isDragging = true);
            document.addEventListener('mouseup', () => isDragging = false);
            document.addEventListener('mousemove', (e) => {
                if(isDragging) {
                    liverGroup.rotation.y += (e.clientX - previousMouse.x) * 0.01;
                    liverGroup.rotation.x += (e.clientY - previousMouse.y) * 0.01;
                }
                previousMouse = { x: e.clientX, y: e.clientY };
            });

            animate();
        }

        function createModel() {
            const liverMat = new THREE.MeshStandardMaterial({ color: 0x8b2626, roughness: 0.3 });
            const veinMat = new THREE.MeshStandardMaterial({ color: 0x3182ce });
            const arteryMat = new THREE.MeshStandardMaterial({ color: 0xe53e3e });
            const gallMat = new THREE.MeshStandardMaterial({ color: 0xcca84a, roughness: 0.1 });
            const ductMat = new THREE.MeshStandardMaterial({ color: 0x7c7c1c });

            // 1. MAIN LIVER MASS
            const liverGeo = new THREE.SphereGeometry(2.5, 32, 32);
            liverGeo.scale(1.5, 0.7, 1);
            const pos = liverGeo.attributes.position;
            for(let i=0; i<pos.count; i++) {
                let x = pos.getX(i);
                let y = pos.getY(i);
                if(x < 0) pos.setY(i, y * (1 + Math.abs(x)*0.3)); // Taper right
                if(x > 1) pos.setX(i, x * 1.5); // Extend right lobe
            }
            const liver = new THREE.Mesh(liverGeo, liverMat);
            liver.userData.name = 'Liver Tissue';
            liverGroup.add(liver);

            // 2. INFERIOR VENA CAVA (Large Blue Vertical)
            const ivcGeo = new THREE.CylinderGeometry(0.35, 0.35, 6, 16);
            const ivc = new THREE.Mesh(ivcGeo, veinMat);
            ivc.position.set(0.2, 0, -0.5);
            ivc.userData.name = 'Inferior Vena Cava';
            liverGroup.add(ivc);

            // 3. AORTA (Red Vertical behind IVC)
            const aortaGeo = new THREE.CylinderGeometry(0.3, 0.3, 6, 16);
            const aorta = new THREE.Mesh(aortaGeo, arteryMat);
            aorta.position.set(0.8, 0, -1);
            aorta.userData.name = 'Aorta';
            liverGroup.add(aorta);

            // 4. PORTAL VEIN (Blue branches)
            const pvRoot = new THREE.Mesh(new THREE.CylinderGeometry(0.25, 0.25, 2), veinMat);
            pvRoot.position.set(0.5, -1.5, 0.5);
            pvRoot.rotation.z = -0.3;
            pvRoot.userData.name = 'Portal vein';
            liverGroup.add(pvRoot);

            // Branches
            const branch1 = new THREE.Mesh(new THREE.CylinderGeometry(0.15, 0.1, 2), veinMat);
            branch1.position.set(-0.5, 0.2, 0.8);
            branch1.rotation.z = 1.2;
            branch1.userData.name = 'Portal vein';
            liverGroup.add(branch1);

            // 5. HEPATIC ARTERY
            const haGeo = new THREE.CylinderGeometry(0.15, 0.15, 2);
            const ha = new THREE.Mesh(haGeo, arteryMat);
            ha.position.set(1.2, -1.8, 0.4);
            ha.rotation.z = 0.4;
            ha.userData.name = 'Hepatic artery';
            liverGroup.add(ha);

            // 6. GALL BLADDER
            const gallGeo = new THREE.SphereGeometry(0.45, 24, 24);
            gallGeo.scale(0.8, 1.4, 0.8);
            const gall = new THREE.Mesh(gallGeo, gallMat);
            gall.position.set(-0.8, -0.8, 1.2);
            gall.rotation.z = 0.5;
            gall.userData.name = 'Gall bladder';
            liverGroup.add(gall);

            // 7. COMMON BILE DUCT
            const ductCurve = new THREE.CatmullRomCurve3([
                new THREE.Vector3(-0.6, -1.2, 1.1),
                new THREE.Vector3(-0.2, -1.8, 0.8),
                new THREE.Vector3(0.1, -2.8, 0.5)
            ]);
            const ductGeo = new THREE.TubeGeometry(ductCurve, 20, 0.08, 8, false);
            const duct = new THREE.Mesh(ductGeo, ductMat);
            duct.userData.name = 'Common bile duct';
            liverGroup.add(duct);
        }

        function onMouseMove(event) {
            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        function animate() {
            requestAnimationFrame(animate);
            const time = clock.getElapsedTime();

            // Organic Movement (Breathing)
            const scale = 1 + Math.sin(time * 0.7) * 0.015;
            liverGroup.scale.set(scale, scale, scale);
            liverGroup.position.y = Math.sin(time * 0.7) * 0.05;

            // Interaction
            raycaster.setFromCamera(mouse, camera);
            const intersects = raycaster.intersectObjects(liverGroup.children, true);
            const info = document.getElementById('label-info');

            if (intersects.length > 0) {
                const obj = intersects[0].object;
                const name = obj.userData.name;
                if (name && labels[name]) {
                    info.style.display = 'block';
                    document.getElementById('title').innerText = name;
                    document.getElementById('desc').innerText = labels[name];
                    
                    if (INTERSECTED !== obj) {
                        if (INTERSECTED && INTERSECTED.material.emissive) INTERSECTED.material.emissive.setHex(0x000000);
                        INTERSECTED = obj;
                        if (INTERSECTED.material.emissive) INTERSECTED.material.emissive.setHex(0x221111);
                    }
                }
            } else {
                info.style.display = 'none';
                if (INTERSECTED && INTERSECTED.material.emissive) INTERSECTED.material.emissive.setHex(0x000000);
                INTERSECTED = null;
            }

            renderer.render(scene, camera);
        }

        init();
    </script>
</body>
</html>

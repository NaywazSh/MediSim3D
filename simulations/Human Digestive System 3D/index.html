<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Human Digestive System 3D</title>
    <style>
        :root {
            --organ-pink: #ffb6c1;
            --organ-red: #d32f2f;
            --organ-yellow: #fdd835;
            --organ-liver: #8b4513;
            --ui-blue: #1a237e;
            --panel-bg: rgba(255, 255, 255, 0.9);
        }
        body { 
            margin: 0; 
            overflow: hidden; 
            background: radial-gradient(circle at center, #ffffff 0%, #f3e5f5 100%); 
            font-family: 'Segoe UI', Tahoma, sans-serif; 
            color: #333; 
        }
        
        #header {
            position: absolute;
            top: 30px;
            left: 30px;
            z-index: 10;
            pointer-events: none;
        }

        .glass-panel {
            background: var(--panel-bg);
            backdrop-filter: blur(10px);
            padding: 20px;
            border-radius: 12px;
            border-left: 6px solid var(--organ-red);
            pointer-events: auto;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            max-width: 300px;
        }

        h1 { margin: 0; font-size: 1.2rem; color: var(--ui-blue); text-transform: uppercase; letter-spacing: 1px; }
        .sub-text { font-size: 0.85rem; color: #666; margin-top: 5px; display: block; }

        #data-panel {
            position: absolute;
            top: 30px;
            right: 30px;
            width: 260px;
            background: var(--panel-bg);
            backdrop-filter: blur(15px);
            padding: 20px;
            border-radius: 12px;
            border: 1px solid rgba(0,0,0,0.05);
            display: none;
            pointer-events: none;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }

        #controls-hint {
            position: absolute;
            bottom: 25px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.7rem;
            font-weight: bold;
            color: #777;
            text-transform: uppercase;
            background: rgba(255,255,255,0.8);
            padding: 6px 20px;
            border-radius: 20px;
        }

        .anatomy-title {
            color: var(--organ-red);
            font-weight: bold;
            font-size: 1.1rem;
            margin-bottom: 5px;
            display: block;
        }
    </style>
</head>
<body>

    <div id="header">
        <div class="glass-panel">
            <h1>Digestive System</h1>
            <span class="sub-text">Interactive 3D Physiological Model</span>
            <p style="font-size: 0.8rem; line-height: 1.4; color: #444;">
                Observe <strong>peristalsis</strong> and organ placement. Hover over specific parts to learn their biological functions.
            </p>
        </div>
    </div>

    <div id="data-panel">
        <span id="part-title" class="anatomy-title">Part Name</span>
        <p id="part-desc" style="font-size: 0.85rem; margin: 0; line-height: 1.5; color: #444;">Description...</p>
    </div>

    <div id="controls-hint">Left Click: Orbit • Scroll: Zoom • Right Click: Pan</div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>

    <script>
        let scene, camera, renderer, controls, raycaster, mouse;
        let digestiveGroup, INTERSECTED;
        let esophagus, stomach, liver, smallIntestine, largeIntestine;

        const anatomyData = {
            'Esophagus': 'A muscular tube connecting the throat to the stomach. It uses rhythmic contractions (peristalsis) to push food down.',
            'Stomach': 'A J-shaped organ that secretes acid and enzymes to chemically break down food into a liquid mixture called chyme.',
            'Liver': 'The body\'s largest internal organ. It produces bile, which helps digest fats, and filters toxins from the blood.',
            'Gallbladder': 'A small pouch located under the liver that stores and concentrates bile until it is needed for digestion.',
            'Small Intestine': 'Where 90% of digestion and nutrient absorption occurs. It is highly coiled to maximize surface area.',
            'Large Intestine': 'Also known as the colon, it connects the small intestine to the rectum, absorbing water and electrolytes.',
            'Pancreas': 'Secretes digestive enzymes into the small intestine and produces insulin to regulate blood sugar.'
        };

        function init() {
            scene = new THREE.Scene();
            scene.fog = new THREE.FogExp2(0xf3e5f5, 0.02);

            camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(0, 5, 25);

            renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(window.devicePixelRatio);
            document.body.appendChild(renderer.domElement);

            controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;

            raycaster = new THREE.Raycaster();
            mouse = new THREE.Vector2();

            // Lights
            scene.add(new THREE.AmbientLight(0xffffff, 0.6));
            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight.position.set(5, 10, 7.5);
            scene.add(directionalLight);

            createModel();
            
            window.addEventListener('resize', onWindowResize);
            window.addEventListener('mousemove', onMouseMove);
            
            animate();
        }

        function createModel() {
            digestiveGroup = new THREE.Group();
            scene.add(digestiveGroup);

            // 1. Esophagus
            const esophagusGeo = new THREE.CylinderGeometry(0.3, 0.3, 8, 16);
            const esophagusMat = new THREE.MeshPhongMaterial({ color: 0xffa4a4, shininess: 50 });
            esophagus = new THREE.Mesh(esophagusGeo, esophagusMat);
            esophagus.position.y = 8;
            esophagus.userData.name = 'Esophagus';
            digestiveGroup.add(esophagus);

            // 2. Stomach (Updated to Yellow)
            const stomachGeo = new THREE.SphereGeometry(2, 32, 32);
            stomachGeo.scale(1.2, 0.8, 1);
            const stomachMat = new THREE.MeshPhongMaterial({ color: 0xfdd835, shininess: 40 });
            stomach = new THREE.Mesh(stomachGeo, stomachMat);
            stomach.position.set(1, 3, 0);
            stomach.rotation.z = -Math.PI / 6;
            stomach.userData.name = 'Stomach';
            digestiveGroup.add(stomach);

            // 3. Liver
            const liverGeo = new THREE.SphereGeometry(2.5, 32, 32);
            liverGeo.scale(1.4, 0.6, 1);
            const liverMat = new THREE.MeshPhongMaterial({ color: 0x8d6e63 });
            liver = new THREE.Mesh(liverGeo, liverMat);
            liver.position.set(-2, 4.5, 1);
            liver.rotation.z = Math.PI / 8;
            liver.userData.name = 'Liver';
            digestiveGroup.add(liver);

            // 4. Large Intestine
            const liPath = new THREE.CatmullRomCurve3([
                new THREE.Vector3(2.5, -4, 0.5),
                new THREE.Vector3(3, -1, 0.5),
                new THREE.Vector3(2.5, 1.5, 0.5),
                new THREE.Vector3(0, 2, 0.5),
                new THREE.Vector3(-2.5, 1.5, 0.5),
                new THREE.Vector3(-3, -2, 0.5),
                new THREE.Vector3(-1.5, -4.5, 0.8),
                new THREE.Vector3(0, -5, 1)
            ]);
            
            const liGeo = new THREE.TubeGeometry(liPath, 64, 0.6, 12, false);
            const liMat = new THREE.MeshPhongMaterial({ color: 0xffcdd2, shininess: 30 });
            largeIntestine = new THREE.Mesh(liGeo, liMat);
            largeIntestine.userData.name = 'Large Intestine';
            digestiveGroup.add(largeIntestine);

            // 5. Small Intestine
            smallIntestine = new THREE.Group();
            for (let i = 0; i < 18; i++) {
                const coilGeo = new THREE.TorusGeometry(1.2, 0.25, 8, 20);
                const coilMat = new THREE.MeshPhongMaterial({ color: 0xffab91 });
                const coil = new THREE.Mesh(coilGeo, coilMat);
                coil.position.set(Math.random() * 2 - 1, Math.random() * 2 - 2, Math.random() * 0.5);
                coil.rotation.set(Math.random(), Math.random(), Math.random());
                coil.userData.name = 'Small Intestine';
                smallIntestine.add(coil);
            }
            digestiveGroup.add(smallIntestine);
        }

        function onMouseMove(event) {
            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        function animate() {
            requestAnimationFrame(animate);
            const time = performance.now() * 0.001;

            const esoWave = Math.sin(time * 2) * 0.05 + 1;
            esophagus.scale.set(esoWave, 1, esoWave);

            const stomachScale = 1 + Math.sin(time * 1.5) * 0.03;
            stomach.scale.set(stomachScale, stomachScale, stomachScale);

            const liPulse = 1 + Math.sin(time * 1.2) * 0.04;
            largeIntestine.scale.set(liPulse, liPulse, liPulse);

            smallIntestine.children.forEach((coil, i) => {
                const pulse = 1 + Math.sin(time * 2 + i) * 0.05;
                coil.scale.set(pulse, pulse, pulse);
            });

            raycaster.setFromCamera(mouse, camera);
            const intersects = raycaster.intersectObjects(digestiveGroup.children, true);
            const info = document.getElementById('data-panel');

            if (intersects.length > 0) {
                let obj = intersects[0].object;
                while (obj && !obj.userData.name && obj.parent) obj = obj.parent;
                const name = obj.userData.name;

                if (name && anatomyData[name]) {
                    info.style.display = 'block';
                    document.getElementById('part-title').innerText = name;
                    document.getElementById('part-desc').innerText = anatomyData[name];
                    
                    if (INTERSECTED !== obj) {
                        if (INTERSECTED && INTERSECTED.material && INTERSECTED.material.emissive) INTERSECTED.material.emissive.set(0x000000);
                        INTERSECTED = obj;
                        // Use a darker highlight for the stomach to be visible on yellow
                        if (INTERSECTED.material && INTERSECTED.material.emissive) INTERSECTED.material.emissive.set(0x332200);
                    }
                }
            } else {
                info.style.display = 'none';
                if (INTERSECTED && INTERSECTED.material && INTERSECTED.material.emissive) INTERSECTED.material.emissive.set(0x000000);
                INTERSECTED = null;
            }

            controls.update();
            renderer.render(scene, camera);
        }

        init();
    </script>
</body>
</html>

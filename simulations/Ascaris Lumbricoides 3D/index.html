<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ascaris lumbricoides 3D Anatomy</title>
    <style>
        :root {
            --organ-pink: #e6b3b3;
            --text-accent: #ffcc00;
            --bg-dark: #120a0a;
        }
        body { margin: 0; overflow: hidden; background: radial-gradient(circle at center, #2c1a1a 0%, #000 100%); font-family: 'Segoe UI', Tahoma, sans-serif; color: white; }
        
        #ui-header {
            position: absolute;
            top: 30px;
            left: 30px;
            z-index: 10;
            pointer-events: none;
        }

        .glass-panel {
            background: rgba(40, 20, 20, 0.7);
            backdrop-filter: blur(10px);
            padding: 25px;
            border-radius: 15px;
            border-left: 4px solid var(--organ-pink);
            pointer-events: auto;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            max-width: 320px;
        }

        h1 { margin: 0; font-size: 1.5rem; color: var(--organ-pink); text-transform: uppercase; letter-spacing: 2px; }
        .sci-name { font-style: italic; font-size: 0.9rem; opacity: 0.7; margin-bottom: 12px; display: block; }

        #annotation-box {
            position: absolute;
            top: 30px;
            right: 30px;
            width: 280px;
            background: rgba(30, 10, 10, 0.85);
            backdrop-filter: blur(15px);
            padding: 20px;
            border-radius: 12px;
            border: 1px solid var(--organ-pink);
            display: none;
            pointer-events: none;
            box-shadow: 0 0 25px rgba(230, 179, 179, 0.2);
        }

        #controls-hint {
            position: absolute;
            bottom: 25px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.75rem;
            opacity: 0.5;
            letter-spacing: 1.5px;
            text-transform: uppercase;
            background: rgba(0,0,0,0.4);
            padding: 8px 20px;
            border-radius: 20px;
        }

        .label-tag {
            color: var(--text-accent);
            font-weight: bold;
            font-size: 1.1rem;
            margin-bottom: 5px;
            display: block;
        }
    </style>
</head>
<body>

    <div id="ui-header">
        <div class="glass-panel">
            <h1>Ascaris lumbricoides</h1>
            <span class="sci-name">Phylum: Nematoda | Large Roundworm</span>
            <p style="font-size: 0.85rem; line-height: 1.5; margin: 0; opacity: 0.9;">
                A human parasite characterized by its cylindrical shape and tri-radiate lips. This model displays the 
                <strong>Male</strong> morphology with a distinctive curved posterior.
            </p>
        </div>
    </div>

    <div id="annotation-box">
        <span id="part-title" class="label-tag">Part Name</span>
        <p id="part-desc" style="font-size: 0.9rem; margin: 0; line-height: 1.5;">Description goes here...</p>
    </div>

    <div id="controls-hint">Rotate: Left Click • Zoom: Scroll • Inspect: Hover</div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>

    <script>
        let scene, camera, renderer, controls, raycaster, mouse;
        let wormCurve, wormMesh, wormPoints = [];
        let interactableObjects = [];
        let INTERSECTED;

        const anatomyData = {
            'Mouth / Lips': 'Located at the anterior end, it consists of three finely denticulated lips (one dorsal, two ventrolateral).',
            'Excretory Pore': 'A tiny mid-ventral opening situated about 2mm from the anterior end for waste removal.',
            'Lateral Lines': 'Longitudinal lines running along the sides of the body, marking the location of the epidermal chords.',
            'Curved Tail': 'Characteristic of male Ascaris, the posterior end is ventrally curved and contains penial setae.',
            'Cuticle': 'The thick, tough, elastic, and non-cellular outer layer that protects the worm from host digestive enzymes.',
            'Cylindrical Body': 'The worm is unsegmented and tapers at both ends, optimized for living in the small intestine.'
        };

        function init() {
            scene = new THREE.Scene();
            scene.fog = new THREE.FogExp2(0x1a0a0a, 0.05);

            camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(0, 5, 15);

            renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(window.devicePixelRatio);
            document.body.appendChild(renderer.domElement);

            controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;

            raycaster = new THREE.Raycaster();
            mouse = new THREE.Vector2();

            // Lighting
            scene.add(new THREE.AmbientLight(0xffffff, 0.3));
            const mainLight = new THREE.PointLight(0xffcccc, 1.2);
            mainLight.position.set(10, 10, 10);
            scene.add(mainLight);

            const sideLight = new THREE.DirectionalLight(0xffffff, 0.5);
            sideLight.position.set(-10, 0, 5);
            scene.add(sideLight);

            createAscaris();
            window.addEventListener('resize', onWindowResize);
            window.addEventListener('mousemove', onMouseMove);
            
            animate();
        }

        function createAscaris() {
            // Define points for the worm body
            const numPoints = 12;
            for (let i = 0; i < numPoints; i++) {
                wormPoints.push(new THREE.Vector3(i - numPoints/2, 0, 0));
            }

            wormCurve = new THREE.CatmullRomCurve3(wormPoints);
            
            // Tube geometry for the body
            const geometry = new THREE.TubeGeometry(wormCurve, 64, 0.4, 16, false);
            const material = new THREE.MeshPhongMaterial({
                color: 0xe6b3b3,
                shininess: 60,
                specular: 0x331111,
                emissive: 0x220000
            });

            wormMesh = new THREE.Mesh(geometry, material);
            wormMesh.userData.name = 'Cylindrical Body';
            scene.add(wormMesh);
            interactableObjects.push(wormMesh);

            // Add Specific Parts
            // 1. Mouth (Anterior)
            const mouthGeo = new THREE.SphereGeometry(0.45, 16, 16);
            const mouth = new THREE.Mesh(mouthGeo, material);
            mouth.userData.name = 'Mouth / Lips';
            scene.add(mouth);
            interactableObjects.push(mouth);

            // 2. Excretory Pore (Anterior Ventral)
            const poreGeo = new THREE.SphereGeometry(0.1, 8, 8);
            const poreMat = new THREE.MeshBasicMaterial({ color: 0x550000 });
            const pore = new THREE.Mesh(poreGeo, poreMat);
            pore.userData.name = 'Excretory Pore';
            scene.add(pore);
            interactableObjects.push(pore);

            // 3. Curved Tail (Posterior)
            const tailGeo = new THREE.SphereGeometry(0.3, 16, 16);
            const tail = new THREE.Mesh(tailGeo, material);
            tail.userData.name = 'Curved Tail';
            scene.add(tail);
            interactableObjects.push(tail);

            // Save references for animation
            wormMesh.mouth = mouth;
            wormMesh.pore = pore;
            wormMesh.tail = tail;
        }

        function onMouseMove(event) {
            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        function animate() {
            requestAnimationFrame(animate);
            const time = performance.now() * 0.002;

            // 1. ANIMATE BODY (Serpentine Motion)
            wormPoints.forEach((p, i) => {
                // Wave travels through body
                const offset = i * 0.5;
                p.y = Math.sin(time * 2 + offset) * 0.8;
                p.z = Math.cos(time * 1.5 + offset) * 0.4;
                
                // Exaggerate tail curve (Male trait)
                if (i === 0) {
                    p.y -= 1.5; // Fixed curve at tail
                    p.x += 0.5;
                }
            });

            // Update Geometry
            wormMesh.geometry.dispose();
            wormCurve = new THREE.CatmullRomCurve3(wormPoints);
            wormMesh.geometry = new THREE.TubeGeometry(wormCurve, 64, 0.4, 16, false);

            // 2. POSITION ANATOMICAL MARKERS
            const mouthPos = wormCurve.getPoint(1.0);
            const tailPos = wormCurve.getPoint(0.0);
            const porePos = wormCurve.getPoint(0.92); // Near mouth

            wormMesh.mouth.position.copy(mouthPos);
            wormMesh.tail.position.copy(tailPos);
            wormMesh.pore.position.copy(porePos);
            wormMesh.pore.position.y -= 0.35; // Ventral side

            // 3. RAYCASTING
            raycaster.setFromCamera(mouse, camera);
            const intersects = raycaster.intersectObjects(interactableObjects);
            const info = document.getElementById('annotation-box');

            if (intersects.length > 0) {
                const obj = intersects[0].object;
                const name = obj.userData.name;

                if (name && anatomyData[name]) {
                    info.style.display = 'block';
                    document.getElementById('part-title').innerText = name;
                    document.getElementById('part-desc').innerText = anatomyData[name];
                    
                    if (INTERSECTED != obj) {
                        if (INTERSECTED && INTERSECTED.material.emissive) INTERSECTED.material.emissive.setHex(0x220000);
                        INTERSECTED = obj;
                        if (INTERSECTED.material.emissive) INTERSECTED.material.emissive.setHex(0x660000);
                    }
                }
            } else {
                info.style.display = 'none';
                if (INTERSECTED && INTERSECTED.material.emissive) INTERSECTED.material.emissive.setHex(0x220000);
                INTERSECTED = null;
            }

            controls.update();
            renderer.render(scene, camera);
        }

        init();
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Realistic 3D Human Heart</title>
    <style>
        body { margin: 0; overflow: hidden; background: radial-gradient(circle, #1a0505 0%, #050000 100%); font-family: 'Segoe UI', sans-serif; color: #fff; }
        canvas { display: block; }
        
        #ui {
            position: absolute;
            top: 30px;
            left: 30px;
            z-index: 100;
            pointer-events: none;
        }

        .glass-panel {
            background: rgba(30, 5, 5, 0.7);
            backdrop-filter: blur(12px);
            padding: 20px;
            border-radius: 15px;
            border: 1px solid rgba(255, 50, 50, 0.3);
            max-width: 280px;
            pointer-events: auto;
            box-shadow: 0 8px 32px rgba(0,0,0,0.5);
        }

        h1 { margin: 0; font-size: 1.3rem; color: #ff4d4d; text-transform: uppercase; letter-spacing: 2px; }
        p { font-size: 0.85rem; line-height: 1.5; opacity: 0.8; margin-top: 8px; }

        .info-tag {
            position: absolute;
            bottom: 40px;
            right: 40px;
            text-align: right;
            pointer-events: none;
            background: rgba(20, 0, 0, 0.8);
            padding: 20px;
            border-radius: 12px;
            border-right: 4px solid #ff3333;
            max-width: 350px;
            transition: all 0.3s ease;
        }

        .tag-title { font-size: 1.6rem; color: #ff6666; font-weight: bold; margin: 0; }
        .tag-desc { font-size: 0.95rem; color: #ffcccc; opacity: 0.9; margin-top: 5px; }

        #hint {
            position: absolute;
            bottom: 15px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.75rem;
            opacity: 0.4;
            letter-spacing: 2px;
            text-transform: uppercase;
        }
    </style>
</head>
<body>

    <div id="ui">
        <div class="glass-panel">
            <h1>Cardiac Anatomy</h1>
            <p>Advanced 3D reconstruction featuring coronary networks, pulmonary veins, and rhythmic diastolic-systolic simulation.</p>
        </div>
    </div>

    <div class="info-tag" id="tag-container" style="display:none;">
        <p class="tag-title" id="obj-name">Part Name</p>
        <p class="tag-desc" id="obj-desc">Description</p>
    </div>

    <div id="hint">DRAG TO ROTATE • SCROLL TO ZOOM • HOVER FOR ANATOMY</div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        let scene, camera, renderer, heartGroup;
        let mouse = new THREE.Vector2();
        let raycaster = new THREE.Raycaster();
        let clock = new THREE.Clock();
        let INTERSECTED;

        const anatomyData = {
            'Ventricles': 'The muscular lower chambers. The apex (bottom point) is primarily the left ventricle, which generates high pressure to circulate blood.',
            'Atria': 'Upper chambers that receive blood. The right atrium receives deoxygenated blood, while the left receives oxygenated blood.',
            'Aorta': 'The largest artery in the body. Its arch distributes oxygenated blood to the head, neck, and arms.',
            'Pulmonary Trunk': 'Branches into left and right pulmonary arteries to carry deoxygenated blood to the lungs.',
            'Vena Cava': 'The Superior and Inferior Vena Cava return all deoxygenated blood from the body to the right atrium.',
            'Pulmonary Veins': 'The only veins in the body that carry oxygen-rich blood, returning it from the lungs to the left atrium.',
            'Coronary Vessels': 'Surface arteries and veins that provide the heart muscle itself with the oxygen it needs to pump.'
        };

        function init() {
            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(0, 1, 9);

            renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(window.devicePixelRatio);
            document.body.appendChild(renderer.domElement);

            // Enhanced Lighting
            scene.add(new THREE.AmbientLight(0xffffff, 0.3));
            
            const rimLight = new THREE.SpotLight(0xffffff, 1.5);
            rimLight.position.set(-10, 5, 5);
            scene.add(rimLight);

            const fillLight = new THREE.PointLight(0xff3333, 0.8);
            fillLight.position.set(5, -5, 2);
            scene.add(fillLight);

            heartGroup = new THREE.Group();
            scene.add(heartGroup);

            createHeartModel();

            window.addEventListener('resize', onWindowResize);
            document.addEventListener('mousemove', onMouseMove);
            
            let isDragging = false;
            let prevMouse = { x: 0, y: 0 };
            document.addEventListener('mousedown', () => isDragging = true);
            document.addEventListener('mouseup', () => isDragging = false);
            document.addEventListener('mousemove', (e) => {
                if(isDragging) {
                    heartGroup.rotation.y += (e.clientX - prevMouse.x) * 0.007;
                    heartGroup.rotation.x += (e.clientY - prevMouse.y) * 0.007;
                }
                prevMouse = { x: e.clientX, y: e.clientY };
            });

            animate();
        }

        function createHeartModel() {
            const fleshMat = new THREE.MeshStandardMaterial({ color: 0x991111, roughness: 0.7, metalness: 0.1 });
            const arteryMat = new THREE.MeshStandardMaterial({ color: 0xcc3333, roughness: 0.4 });
            const veinMat = new THREE.MeshStandardMaterial({ color: 0x2244aa, roughness: 0.4 });

            // 1. VENTRICLES (Irregular cone shape)
            const ventGeo = new THREE.SphereGeometry(1.6, 32, 32);
            ventGeo.scale(1, 1.5, 0.9);
            // Deform bottom to create Apex
            const posAttr = ventGeo.attributes.position;
            for(let i=0; i<posAttr.count; i++) {
                let y = posAttr.getY(i);
                if(y < 0) {
                    posAttr.setX(i, posAttr.getX(i) * (1 + y*0.1));
                    posAttr.setZ(i, posAttr.getZ(i) * (1 + y*0.1));
                }
            }
            const vent = new THREE.Mesh(ventGeo, fleshMat);
            vent.userData = { name: 'Ventricles' };
            heartGroup.add(vent);

            // 2. ATRIA
            const atriaGeo = new THREE.SphereGeometry(1.1, 24, 24);
            atriaGeo.scale(1.4, 0.8, 1.2);
            const atria = new THREE.Mesh(atriaGeo, fleshMat);
            atria.position.y = 1.3;
            atria.userData = { name: 'Atria' };
            heartGroup.add(atria);

            // 3. AORTIC ARCH
            const aortaCurve = new THREE.CatmullRomCurve3([
                new THREE.Vector3(0.3, 1.8, -0.2),
                new THREE.Vector3(0.5, 3.8, -0.2),
                new THREE.Vector3(-1.2, 4.2, -0.6),
                new THREE.Vector3(-2.2, 2.5, -1.2),
                new THREE.Vector3(-2.4, 0, -1.4)
            ]);
            const aortaGeo = new THREE.TubeGeometry(aortaCurve, 40, 0.45, 12, false);
            const aorta = new THREE.Mesh(aortaGeo, arteryMat);
            aorta.userData = { name: 'Aorta' };
            heartGroup.add(aorta);

            // 4. PULMONARY TRUNK
            const ptCurve = new THREE.CatmullRomCurve3([
                new THREE.Vector3(-0.5, 1.5, 0.6),
                new THREE.Vector3(-0.9, 3.2, 0.4),
                new THREE.Vector3(-2.5, 3.5, 0.2)
            ]);
            const ptGeo = new THREE.TubeGeometry(ptCurve, 20, 0.4, 12, false);
            const pt = new THREE.Mesh(ptGeo, arteryMat);
            pt.userData = { name: 'Pulmonary Trunk' };
            heartGroup.add(pt);

            // 5. VENA CAVA (Superior & Inferior)
            const vcMat = new THREE.MeshStandardMaterial({ color: 0x3355bb });
            const svcGeo = new THREE.CylinderGeometry(0.35, 0.35, 2.5, 12);
            const svc = new THREE.Mesh(svcGeo, vcMat);
            svc.position.set(1.2, 2.8, -0.4);
            svc.rotation.z = -0.2;
            svc.userData = { name: 'Vena Cava' };
            heartGroup.add(svc);

            const ivc = svc.clone();
            ivc.position.set(1.4, -1.5, -0.6);
            heartGroup.add(ivc);

            // 6. PULMONARY VEINS
            const pvGeo = new THREE.CylinderGeometry(0.2, 0.2, 1.5, 8);
            for(let i=0; i<2; i++) {
                const pv = new THREE.Mesh(pvGeo, vcMat);
                pv.position.set(-1.8, 1.8, -0.5);
                pv.rotation.z = Math.PI / 2;
                pv.rotation.x = i * 0.4;
                pv.userData = { name: 'Pulmonary Veins' };
                heartGroup.add(pv);
            }

            // 7. CORONARY NETWORK (Surface Details)
            for(let i=0; i<15; i++) {
                const segGeo = new THREE.CylinderGeometry(0.04, 0.02, 1, 6);
                const seg = new THREE.Mesh(segGeo, Math.random() > 0.5 ? arteryMat : veinMat);
                const phi = Math.random() * Math.PI;
                const theta = Math.random() * Math.PI * 2;
                seg.position.setFromSphericalCoords(1.6, phi, theta);
                seg.position.y *= 1.3;
                seg.lookAt(0,0,0);
                seg.rotateX(Math.PI/2);
                seg.userData = { name: 'Coronary Vessels' };
                heartGroup.add(seg);
            }
        }

        function onMouseMove(event) {
            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        function animate() {
            requestAnimationFrame(animate);
            const time = clock.getElapsedTime();

            // Heartbeat Logic: Systole & Diastole
            const pulseCycle = time * 4.5;
            const heartBeat = 1 + Math.pow(Math.sin(pulseCycle), 12) * 0.06 + Math.pow(Math.sin(pulseCycle - 0.4), 12) * 0.04;
            heartGroup.scale.set(heartBeat, heartBeat, heartBeat);

            // Subtle bounce
            heartGroup.position.y = Math.sin(time) * 0.1;
            if(!INTERSECTED) heartGroup.rotation.y += 0.003;

            raycaster.setFromCamera(mouse, camera);
            const intersects = raycaster.intersectObjects(heartGroup.children, true);
            const tagContainer = document.getElementById('tag-container');

            if (intersects.length > 0) {
                const obj = intersects[0].object;
                const name = obj.userData.name;
                
                if (name && anatomyData[name]) {
                    tagContainer.style.display = 'block';
                    document.getElementById('obj-name').innerText = name;
                    document.getElementById('obj-desc').innerText = anatomyData[name];
                    
                    if (INTERSECTED != obj) {
                        if (INTERSECTED && INTERSECTED.material.emissive) INTERSECTED.material.emissive.setHex(0x000000);
                        INTERSECTED = obj;
                        if(INTERSECTED.material.emissive) INTERSECTED.material.emissive.setHex(0x441111);
                    }
                }
            } else {
                tagContainer.style.display = 'none';
                if (INTERSECTED && INTERSECTED.material.emissive) INTERSECTED.material.emissive.setHex(0x000000);
                INTERSECTED = null;
            }

            renderer.render(scene, camera);
        }

        window.onload = init;
    </script>
</body>
</html>

